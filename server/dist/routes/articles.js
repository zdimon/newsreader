// Generated by CoffeeScript 1.9.3
(function() {
  var express, fs, getArticlesFromFS, log, path, router, utils;

  express = require('express');

  router = express.Router();

  utils = require('../utils/utils');

  path = require('path');

  fs = require('fs');

  log = require('winston-color');

  log.level = process.env.LOG_LEVEL;

  getArticlesFromFS = function(journal_id, issue_id) {
    var cont, dest;
    try {
      dest = path.join(global.app_root, global.app_config.data_dir, "articles", "" + journal_id, "" + issue_id, 'articles.json');
      return cont = JSON.parse(fs.readFileSync(dest, 'utf8'));
    } catch (_error) {
      return cont = {
        articles: {
          1: {
            image: 'images/no.png',
            title: 'Извините, текстовая информация отсутствует.'
          }
        }
      };
    }
  };

  router.get('/:journal_id/:issue_id.json', function(req, res, next) {
    var e;
    log.debug('hi' + req.params.journal_id);
    try {
      return res.send(getArticlesFromFS(req.params.journal_id, req.params.issue_id));
    } catch (_error) {
      e = _error;
      return log.error("Error geting catalog! " + e);
    }
  });

  module.exports = router;

}).call(this);
