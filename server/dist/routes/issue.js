// Generated by CoffeeScript 1.9.3
(function() {
  var express, fs, getIssueFromFS, log, path, router, utils;

  express = require('express');

  router = express.Router();

  utils = require('../utils/utils');

  path = require('path');

  fs = require('fs');

  log = require('winston-color');

  log.level = process.env.LOG_LEVEL;

  getIssueFromFS = function(journal_id, issue_id) {
    var cont, cont_pages, dest, e, out, pages_path;
    try {
      dest = path.join(global.app_root, global.app_config.data_dir, "journals", "" + journal_id, "" + issue_id, 'info.json');
      cont = JSON.parse(fs.readFileSync(dest, 'utf8'));
      pages_path = path.join(global.app_root, global.app_config.data_dir, "journals", "" + journal_id, "" + issue_id, 'pages.json');
      cont_pages = JSON.parse(fs.readFileSync(pages_path, 'utf8'));
      return out = {
        status: 0,
        info: cont,
        pages: cont_pages
      };
    } catch (_error) {
      e = _error;
      return cont = {
        status: 1,
        error: 'Извините, информация отсутствует.',
        err: e
      };
    }
  };

  router.get('/:journal_id/:issue_id.json', function(req, res, next) {
    var e;
    log.debug('hi' + req.params.journal_id);
    try {
      return res.send(getIssueFromFS(req.params.journal_id, req.params.issue_id));
    } catch (_error) {
      e = _error;
      return log.error("Error geting pages! " + e);
    }
  });

  module.exports = router;

}).call(this);
