// Generated by CoffeeScript 1.9.3
(function() {
  var dest_pb, express, fs, getCatalogFromFS, jsondata, log, path, router, utils,
    indexOf = [].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; };

  express = require('express');

  router = express.Router();

  utils = require('../utils/utils');

  path = require('path');

  fs = require('fs');

  log = require('winston-color');

  log.level = process.env.LOG_LEVEL;

  dest_pb = path.join(global.app_root, global.app_config.data_dir, 'problem_journal.json');

  jsondata = JSON.parse(fs.readFileSync(dest_pb, 'utf8'));

  getCatalogFromFS = function() {
    var cont, dest, jk, jv, k, ref, ref1, ref2, v;
    dest = path.join(global.app_root, global.app_config.data_dir, "catalog/catalog.json");
    cont = JSON.parse(fs.readFileSync(dest, 'utf8'));
    ref = cont.categories;
    for (k in ref) {
      v = ref[k];
      ref1 = v.journals;
      for (jk in ref1) {
        jv = ref1[jk];
        if (ref2 = jv.id, indexOf.call(jsondata, ref2) >= 0) {
          delete cont.categories[k].journals[jv.id];
        }
      }
    }
    return cont;
  };

  router.get('/', function(req, res, next) {
    var e;
    try {
      return res.send(getCatalogFromFS());
    } catch (_error) {
      e = _error;
      return log.error("Error geting catalog! " + e);
    }
  });

  module.exports = router;

}).call(this);
